id: 01_month_loop_subflow
namespace: zoomcamp

inputs:
  - id: currentTaxi
    type: STRING
    description: The current taxi type (e.g., 'yellow', 'green') from the parent flow.
  - id: currentYear
    type: STRING
    description: The current year (e.g., '2021') from the parent flow.

tasks:
  - id: month_loop
    type: io.kestra.plugin.core.flow.ForEach
    values: ["01","02","03","04","05","06","07","08","09","10","11","12"]
    tasks:
      - id: run_ingestion
        type: io.kestra.plugin.core.flow.Subflow
        flowId: 02_donwload_ingest
        namespace: zoomcamp
        inputs:
          taxi: "{{ inputs.currentTaxi }}" # Use the taxi type passed as input
          year: "{{ inputs.currentYear }}" # Use the year passed as input
          month: "{{ taskrun.value }}"      # Use the current month from this loop